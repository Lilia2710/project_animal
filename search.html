<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="api.js" type="module"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЧипТрекер | Поиск по чипу</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-paw"></i>
                ЧипТрекер
            </a>
            <div class="nav-links">
                <a href="index.html"><i class="fas fa-home"></i> Главная</a>
                <a href="search.html" class="active"><i class="fas fa-search"></i> Поиск по чипу</a>
                <a href="login.html" id="loginLink"><i class="fas fa-sign-in-alt"></i> Вход</a>
                <a href="register.html" id="registerLink"><i class="fas fa-user-plus"></i> Регистрация</a>
                <a href="dashboard.html" id="dashboardLink" style="display: none;"><i class="fas fa-user"></i> Кабинет</a>
            </div>
        </div>
    </nav>

    <!-- Поиск -->
    <section class="search-section">
        <div class="container">
            <div class="search-header">
                <h1><i class="fas fa-search"></i> Поиск животного по номеру чипа</h1>
                <p>Введите 15-значный номер микрочипа для поиска информации о животном</p>
            </div>
            
            <div class="search-container">
                <div class="search-box-large">
                    <input type="text" id="chipSearch" placeholder="Введите номер микрочипа (например: 985120000123456)" 
                           maxlength="15" pattern="[0-9]{15}">
                    <button class="btn btn-primary" id="searchButton">
                        <i class="fas fa-search"></i> Найти
                    </button>
                </div>
                <small class="search-hint">
                    <i class="fas fa-info-circle"></i> Номер микрочипа состоит из 15 цифр и указан в документах на животное
                </small>
            </div>
            
            <div class="search-results" id="searchResults">
                <!-- Результаты поиска будут отображаться здесь -->
                <div class="search-placeholder">
                    <i class="fas fa-search"></i>
                    <h3>Начните поиск</h3>
                    <p>Введите номер микрочипа в поле выше для поиска информации о животном</p>
                </div>
            </div>
            
            <div class="search-info">
                <h2><i class="fas fa-question-circle"></i> Как найти номер микрочипа?</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <h3>В документах</h3>
                        <p>Номер указан в ветеринарном паспорте животного и документах о чипировании</p>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <h3>У ветеринара</h3>
                        <p>Обратитесь к ветеринару, который проводил чипирование вашего питомца</p>
                    </div>
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <h3>Сканирование</h3>
                        <p>Номер можно считать специальным сканером микрочипов</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-paw"></i> ЧипТрекер</h3>
                    <p>Безопасный учет животных по микрочипам</p>
                </div>
                <div class="footer-section">
                    <h4>Контакты</h4>
                    <p><i class="fas fa-phone"></i> +77777777777</p>
                    <p><i class="fas fa-envelope"></i> support@animalchiptracker.ru</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; Не очень защищено</p>
            </div>
        </div>
    </footer>

    <!-- Модальное окно с результатами -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="resultModalContent">
                <!-- Содержимое будет загружено через JavaScript -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chipSearch = document.getElementById('chipSearch');
            const searchButton = document.getElementById('searchButton');
            const searchResults = document.getElementById('searchResults');
            
            // Обновление навигации
            updateNavigation();
            
            // Обработка поиска
            searchButton.addEventListener('click', performSearch);
            chipSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // Форматирование номера чипа
            chipSearch.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 15) value = value.substring(0, 15);
                e.target.value = value;
            });
            
            // Модальное окно
            const resultModal = document.getElementById('resultModal');
            const closeModal = document.querySelector('.close-modal');
            
            closeModal.addEventListener('click', function() {
                resultModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === resultModal) {
                    resultModal.style.display = 'none';
                }
            });
        });
        
        function performSearch() {
            const chipNumber = document.getElementById('chipSearch').value.trim();
            const searchResults = document.getElementById('searchResults');
            
            if (!chipNumber) {
                searchResults.innerHTML = `
                    <div class="search-error">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>Введите номер чипа</h3>
                        <p>Пожалуйста, введите номер микрочипа для поиска</p>
                    </div>
                `;
                return;
            }
            
            if (chipNumber.length !== 15) {
                searchResults.innerHTML = `
                    <div class="search-error">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>Неверный формат</h3>
                        <p>Номер микрочипа должен состоять из 15 цифр</p>
                    </div>
                `;
                return;
            }
            
            // Поиск в данных
            const animals = JSON.parse(localStorage.getItem('animalTrackerAnimals')) || [];
            const foundAnimal = animals.find(animal => animal.chipNumber === chipNumber);
            
            if (foundAnimal) {
                // Отображаем информацию
                searchResults.innerHTML = `
                    <div class="search-result">
                        <div class="result-header">
                            <div class="result-avatar">
                                <i class="fas fa-${getSpeciesIcon(foundAnimal.species)}"></i>
                            </div>
                            <div class="result-title">
                                <h3>${foundAnimal.petName}</h3>
                                <p>${foundAnimal.species} • ${foundAnimal.breed || 'Порода не указана'}</p>
                                <div class="chip-result">
                                    <i class="fas fa-microchip"></i> Номер чипа: ${foundAnimal.chipNumber}
                                </div>
                            </div>
                        </div>
                        <div class="result-info">
                            <div class="info-row">
                                <span class="info-label">Владелец:</span>
                                <span class="info-value">${foundAnimal.ownerName}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Контактный телефон:</span>
                                <span class="info-value">${foundAnimal.ownerPhone}</span>
                            </div>
                            ${foundAnimal.ownerEmail ? `
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value">${foundAnimal.ownerEmail}</span>
                            </div>` : ''}
                            <div class="info-row">
                                <span class="info-label">Дата регистрации:</span>
                                <span class="info-value">${formatDate(foundAnimal.registrationDate)}</span>
                            </div>
                        </div>
                        <div class="result-actions">
                            <p class="result-note">
                                <i class="fas fa-info-circle"></i> Для получения полной информации о животном свяжитесь с владельцем
                            </p>
                        </div>
                    </div>
                `;
            } else {
                searchResults.innerHTML = `
                    <div class="search-not-found">
                        <i class="fas fa-search"></i>
                        <h3>Животное не найдено</h3>
                        <p>Животное с номером чипа <strong>${chipNumber}</strong> не зарегистрировано в системе</p>
                        <p class="suggestions">
                            Если вы являетесь владельцем этого животного, 
                            <a href="login.html">войдите в систему</a> или 
                            <a href="register.html">зарегистрируйтесь</a>, чтобы добавить информацию.
                        </p>
                    </div>
                `;
            }
        }
        
        function getSpeciesIcon(species) {
            const icons = {
                'Собака': 'dog',
                'Кошка': 'cat',
                'Грызун': 'mouse',
                'Птица': 'crow',
                'Рептилия': 'dragon',
                'Другое': 'paw'
            };
            return icons[species] || 'paw';
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Не указана';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }
        
        function updateNavigation() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const loginLink = document.getElementById('loginLink');
            const registerLink = document.getElementById('registerLink');
            const dashboardLink = document.getElementById('dashboardLink');
            
            if (currentUser) {
                if (loginLink) loginLink.style.display = 'none';
                if (registerLink) registerLink.style.display = 'none';
                if (dashboardLink) dashboardLink.style.display = 'block';
            } else {
                if (loginLink) loginLink.style.display = 'block';
                if (registerLink) registerLink.style.display = 'block';
                if (dashboardLink) dashboardLink.style.display = 'none';
            }
        }
    </script>
</body>
</html>